---
title: "Subjects count"
params:
  Country: CO
  ExperimentName: null
  ExperimentID: null
  Session: null    
  datadir: '/home/maximilien.chaumon/ownCloud/Lab/00-Projects/TimeSocialDistancing/DATA/'
output:
  html_notebook:
    code_folding: hide
    df_print: paged
    toc: yes
  html_document:
    code_folding: hide
    df_print: paged
    toc: yes
---

```{r, message=F}
source('helpers.R')

l <- paramsMatch(params = params,experimentIDs = ExperimentIDs)
l$datadir <- params$datadir

```

```{r}
d <- gimmedata(DataDir = params$datadir, ExperimentName = paste(l$ExperimentName,collapse='|'), verbose = F) %>%
  group_by(`Experiment ID`)%>%
  mutate(Country = ID2Country(ExperimentID = `Experiment ID`, ExperimentIDs = ExperimentIDs))

```


```{r}
count <- tibble()
if ('Trial Number' %in% colnames(d)) {
  count <- filter(d,`Trial Number` == 'END TASK') %>%
    group_by(Country,Session,  UniqueName) %>%
    summarize(N = n()) %>%
    bind_rows(count)
}
if ('Question Key' %in% colnames(d)) {
  count <- filter(d,`Question Key` == 'END QUESTIONNAIRE') %>%
  group_by(Country,Session,  UniqueName) %>%
  summarize(N = n()) %>%
    bind_rows(count)
}

ggplot(count,aes(x=UniqueName,y=N,fill = Session)) +
  facet_wrap(~ Country) +
  geom_col(position = position_dodge(width = 1)) +
  geom_label(aes(label=N), position = position_dodge(width = 1), show.legend = F) +
  theme(axis.text.x = element_text(angle = 30,hjust = 1)) +
  labs(x='',y='Count')
```

```{r}
count %>%
  pivot_wider(id_cols = c(Session,UniqueName), names_from = Country, values_from=N) 
```

 
